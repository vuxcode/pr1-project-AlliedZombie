<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta title="Oscar's Project">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">

<style>
   
</style>
</head>
<body>

<div id="buttonHolder" style="display: none;"> 
    <button id="buttonPhysical" onclick="PhysicalAttack()">Physical</button>
    <button id="buttonMagic" onclick="MagicalAttack()">Magic</button>
    <button id="buttonIntimidate" onclick="IntimidateAttack()">Intimidate</button>
</div>

<!--
<div id = DevAttackButtons>
<button id="OrcAttacks" onclick="DamageByOrc()">OrcAttack</button>
<button id="MageAttacks" onclick="DamageByMage()">MageAttack</button>
<button id="TownsfolkAttacks" onclick="DamageByTownsfolk()">TownsfolkAttack</button>
</div>
-->

<div class=gameScreen>
    
    <div class ="bgImage">
        <div class = "Enemies" id = Enemies>
            <div id = "EnemyOrc" style = "display: none;"></div>
            <div id = "EnemyMage" style = "display: none;"></div>
            <div id = "EnemyTownsfolk" style = "display: none;"></div>
        </div>
        <div class = "Player" id = "Player" style = "display: none;">
            <div id = "PlayerChar"></div>
            <div id = "playerHpBar">
                <div id = "barHealth">
                    <div id = "playerHpText"></div>
                </div>
            </div>
        </div>
        <div id = "GameTimerBar" style = "display: none;" ></div>
        
    </div>

    <div class = "Introduction" id ="Introduction" style="display:block;">
        <input type="text" name="name" id="PlayerInputName" placeholder="Your adventure name"/>
        <h2>Your task is to *Bla Bla Bla* save the princess and *Bla Bla Bla* the monsters...</h2>
        <h2>Understood? Good! May the gods be on your side in battle!</h2>
        <button type="button" id="IntroButton" onclick="getPlayerInputName();">Fight</button>
    </div>

    <div class="GameOverScreen" id="GameOverScreen" style = "display: none;">

        <h1> Game Over </h1>
        <h2> Your Highscore = </h2>
        <h2 id="Score"></h2>
    </div>
</div>


<div class ="bgImage"></div>

<!-- Comment -->
<script>

var playerHp = 100;
var enemiesDestroyed = 0;
var enemy;
var enemies = ["EnemyOrc","EnemyMage","EnemyTownsfolk"];
var gameTimer = 30;
var gameTimerFullProcentage = gameTimer;
var PreviousEnemy;
var gameStarted = false;

// If I want to change what buttons that do what.
var buttonPhysical = "KeyA"
var buttonMagical = "KeyS"
var buttonIntimidate = "KeyD"

var physicalAttackButton = document.getElementById("buttonPhysical");
var magicalAttackButton = document.getElementById("buttonMagic");
var intimidateAttackButton = document.getElementById("buttonIntimidate");



document.addEventListener("keydown",function (button){

    if (gameStarted)
    {
        if(button.code === buttonPhysical)
        {
            console.log("I press the button " + button.code);
            ButtonHandler(buttonPhysical);
        }

        else if(button.code === buttonMagical)
        {
            console.log("I press the button " + button.code);
            ButtonHandler(buttonMagical);
        }

        else if(button.code === buttonIntimidate)
        {
            console.log("I press the button " + button.code);
            ButtonHandler(buttonIntimidate);
        }
    }
    

});

function ButtonHandler (buttonClicked)
{
    switch (buttonClicked)
    {
        case buttonPhysical:
            PhysicalAttack();
            break;
        case buttonMagical:
            MagicalAttack();
            break;
        case buttonIntimidate:
            IntimidateAttack();
            break;
    }
}


//An array of enemies that have properties to them. Will probably ad sfx properties here aswell.
var enemyProperty = [ 
{charImageId: "EnemyOrc", minDamage: 50, maxDamage:100},
{charImageId: "EnemyMage", minDamage: 30, maxDamage:70},
{charImageId: "EnemyTownsfolk", minDamage: 10, maxDamage:30}
];


//I want the program to start the introduction at the start.

function getPlayerInputName()
{
    var PlayerName = document.getElementById("PlayerInputName").value;
    if (PlayerName == "" || PlayerName == null)
    {
        PlayerName = "Adventurer"
    }
    Introduction(PlayerName);
}

function Introduction(playerInputName)
{
    // Make a pop up that introduces the player  and asks for the users name and replace the name below playerHpBar with said name.
    // Make it so the user can press outside the box and it will go away.
    // Make the rest of the game start. (Timers and start showing the enemy and Player.)

    document.getElementById("playerHpText").innerText = playerInputName;
    console.log("The players name is: " + playerInputName);
    document.getElementById("Introduction").style.display = "none";
    document.getElementById("Player").style.display="block";
    document.getElementById("buttonHolder").style.display="block";
    document.getElementById("GameTimerBar").style.display="block";
    gameStarted = true;
    EnemySpawnHandler();
    Timer();
}

function Timer()
{

    //console.log(gameTimer);
    if(gameTimer>0)
    {
        gameTimer--;
        setTimeout(Timer,1000);
    }
    else
    {
        GameOverScreen();
    }
    var CurrentGameTimeProcentage = CalculateProcentage(gameTimer, gameTimerFullProcentage)
    document.getElementById("GameTimerBar").style.width = CurrentGameTimeProcentage + "%";
}

function CalculateProcentage(x,y)
{
    return (x * 100)/y;
}
//Calcluate the starting 100% in a separate variable
//for each second the second goes down it should be in % of 100%.


function GetRandomEnemy()
{
    return enemies[Math.floor(Math.random() * enemies.length)]
}

function EnemySpawnHandler (PreviousEnemy = undefined)
{
    console.log("The previous enemy was: " + PreviousEnemy);
    if(PreviousEnemy == undefined) 
    {
        PreviousEnemy = GetRandomEnemy();
    }
    

    enemy = GetRandomEnemy();
    if(enemy != PreviousEnemy)
    {
        console.log("The Random enemy is: " + enemy)
        switch (enemy)
            {
                case "EnemyOrc":
                    EnemyIntro(enemyProperty[0].charImageId)
                    document.getElementById(enemyProperty[0].charImageId).style.animationName = "EnemyIntroAnim";
                    break;
                case "EnemyMage":
                    EnemyIntro(enemyProperty[1].charImageId)
                    document.getElementById(enemyProperty[1].charImageId).style.animationName = "EnemyIntroAnim";                        
                    break;
                case "EnemyTownsfolk":
                    EnemyIntro(enemyProperty[2].charImageId)
                    document.getElementById(enemyProperty[2].charImageId).style.animationName = "EnemyIntroAnim";
                    break;
            }
    }
    else
    {
        EnemySpawnHandler(PreviousEnemy);
    }
    
}

function EnemyIntro(Enemy)
{
    document.getElementById(Enemy).style.display="block";
}


function EnemyExit(Enemy)
{
    console.log("EnemyExit")
    document.getElementById(Enemy).style.animationName = "EnemyExitAnim";
    enemiesDestroyed ++;
    setTimeout (EnemySpawnHandler, 500,Enemy);
}
//#region PlayerAttacks

function PhysicalAttack()
{ 
    switch(enemy)
        {
            case "EnemyOrc":
                EnemyExit("EnemyOrc");
                break;
            case "EnemyMage":
                DamageByMage();
                break;
            case "EnemyTownsfolk":
                DamageByTownsfolk();
        }
    console.log(enemy);    
    console.log("Player used Physical Attack")
}

function MagicalAttack()
{
    switch(enemy)
        {
            case "EnemyOrc":
                DamageByOrc();
                break;
            case "EnemyMage":
                EnemyExit("EnemyMage");
                break;
            case "EnemyTownsfolk":
                DamageByTownsfolk();
                break;
        }
    console.log(enemy);
    console.log("Player used Magical Attack")
}

function IntimidateAttack()
{
    switch(enemy)
        {
            case "EnemyOrc":
                DamageByOrc();
                break;
            case "EnemyMage":
                DamageByMage();
            case "EnemyTownsfolk":
                EnemyExit("EnemyTownsfolk");
                break;
        }
    console.log(enemy);  
    console.log("Player used Intimidate Attack")
     
}

//#endregion


function DamageByOrc()
{
    var damage = getRandomInt(enemyProperty[0].minDamage,enemyProperty[0].maxDamage)
    playerHp -= damage
    document.getElementById("barHealth").style.width = playerHp + "%";
    console.log("Orc hit the player with: " + damage + ". The player is now at :" + playerHp + "%");
    if (playerHp < 0){
        KillPlayer();} 
}

function DamageByMage()
{
    var damage = getRandomInt(enemyProperty[1].minDamage,enemyProperty[1].maxDamage)
    playerHp -= damage
    document.getElementById("barHealth").style.width = playerHp + "%";
    console.log("Mage hit the player with: " + damage + ". The player is now at :" + playerHp + "%");
    if (playerHp < 0){
        KillPlayer();} 
}

function DamageByTownsfolk()
{
    var damage = getRandomInt(enemyProperty[2].minDamage,enemyProperty[2].maxDamage)
    playerHp -= damage
    document.getElementById("barHealth").style.width = playerHp + "%";
    console.log("Townsfolk hit the player with: " + damage + ". The player is now at :" + playerHp + "%");
    if (playerHp < 0){
        KillPlayer();}
}


//Instead of calculating the random value in each function I decided to make it separate. So This function takes a value from the Damage scripts and returns the randomized value. 
//Not a necessary function but I wanted to explore different methods to return a value from other functions.
function getRandomInt(min, max) 
{
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

//When this gets called it will change som css and do some functions
function KillPlayer()
{
    document.getElementById("barHealth").style.width = 0 + "%";
    //Add a game over popup with the Highscore.
    //add a Restart game function and start it here?
    GameOverScreen();

}

function SfxHandler(sfxtype)
{
    //Make a sound play depending on what the sfx type is inpouted in the function SfxHandler.
    //Will probably be enemyTakingDamage, PlayerTakingDamage etc 
} 

function GameOverScreen(PlayerScore)
{
    if(playerHp>0)
    {
        document.getElementById("Enemies").style.display="none";
    }
    else
    {
        document.getElementById("Player").style.display="none";
    }
    document.getElementById("GameOverScreen").style.display = "block";
    document.getElementById("buttonHolder").style.display="none";
    document.getElementById("Score").innerText = enemiesDestroyed;
}


</script>
</body>
</html>